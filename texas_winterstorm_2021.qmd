---
title: ": A Look at Houston's Winter Storm Blackouts"
author: "Melannie Moreno Rolón"
date: "2025-10-27"
format:
  html: 
    code-fold: false
editor: source
execute: 
  warning: false
  message: false
  results: false
editor_options: 
  chunk_output_type: console
---

```{r}
#| label: setup
# Import libraries
library(tidyverse)
library(tmap)
library(terra)
library(geodata)
library(kableExtra)
library(sf)
library(stars)
```


# README.md



# Introduction

Rapid changes in climate are leading to higher intensity and more frequent extreme weather events in recent years. If we look at the United States, there are many examples. One particular event that highlights this increasing pattern in weather events are the February 2021 winter storms in Houston, Texas. For the first time in years, Houston experienced a power outage of massive scale. A combination of extreme weather, grid isolation, and lack of winterization became the perfect storm that exposed Houston's underlying systemic issues. 

This analysis aims to estimate the number of households in the Houston metropolitan area that resulted in loss of electricity service due to the extreme winter storms experienced in February 2021. 

# Methods

Key steps of this analysis include:

1. Find locations that experienced a blackout
2. Exclude highways from analysis
3. Identify homes that experienced blackouts by combining the locations of homes and blackouts
4. Identify the census tracts likely impacted by blackout

# Data Analysis

### Loading in Socioeconomic Data
```{r}
# Explore layers of geopackage
st_layers(here::here("data", "ACS_2019_5YR_TRACT_48_TEXAS.gdb"))

# Load 2019 socioeconomic census tract data
census_tract <- st_read(here::here("data", "ACS_2019_5YR_TRACT_48_TEXAS.gdb"),
                        layer = "ACS_2019_5YR_TRACT_48_TEXAS")
names(census_tract)

# Load household income data
income <- st_read(here::here("data", "ACS_2019_5YR_TRACT_48_TEXAS.gdb"), 
                  layer = "X19_INCOME")

names(income)

# Join census tract data and income data
census_income <- census_tract %>% left_join(income, by = "GEOID")
names(census_income)
```


### Loading in Roads and Structures Data
```{r}
# Load roads data
roads <- st_read(here::here("data", "gis_osm_roads_free_1.gpkg"))
roads
# Load houses data
buildings <- st_read(here::here("data", "gis_osm_buildings_a_free_1.gpkg"))
```

### Loading in Raster Data

```{r}
# February 7 tiles
tile_0705 <- read_stars(here::here("data", "VNP46A1",
                             "VNP46A1.A2021038.h08v05.001.2021039064328.tif"))

tile_0706 <- read_stars(here::here("data","VNP46A1",
                  "VNP46A1.A2021038.h08v06.001.2021039064329.tif"))

# February 16 tiles
tile_1605 <- read_stars(here::here("data", "VNP46A1", "VNP46A1.A2021047.h08v05.001.2021048091106.tif"))


tile_1606 <- read_stars(here::here("data", "VNP46A1",
                             "VNP46A1.A2021047.h08v06.001.2021048091105.tif"))
```

```{r}
# View CRS of each object
st_crs(buildings)
st_crs(census_income)
st_crs(census_tract)
st_crs(income)
st_crs(roads)
st_crs(tile_0705)
st_crs(tile_0706)
st_crs(tile_1605)
st_crs(tile_1606)
```


```{r}
# Check that crs matches between datasets
if(st_crs(buildings) != st_crs(census_income)){
  warning("coordinate refrence systems do not match")
  census_income <- st_transform(buildings, crs = st_crs(buildings))
}
```

```{r}
if(st_crs(census_income) == st_crs(buildings)){
  print("it's a match!")
} else {
  print("still not a match")
}
```

## Create Blackout Mask

(Plot with `plot()` or `ggplot()` to confirm that the reclassified areas match expectations.)

```{r}
# Merge raster objects 
tile_07 <- st_mosaic(tile_0705, tile_0706)
tile_16 <- st_mosaic(tile_1605, tile_1606)
```

```{r}
# Compute the change in light intensity
r_change <- tile_16 - tile_07
```

```{r}
# create raster mask of the same resolution and extent
rmask <- r_change

# set all cells with light less than 200 to NA
rmask[rmask < 200] <- NA
 
# subset elevation raster based on mask
# approach 1: bracket subsetting
masked <- zion_elevation[rmask, drop = FALSE] 

# approach 2: mask() function
masked2 <- mask(zion_elevation, rmask)


# Vectorize
vector_masked_diff <- st_as_sf(masked)

st_is_valid(vector_masked_diff)

st_make_valid(vector_masked_diff)



```

```{r}
map1 <- tm_shape(zion_elevation) +
  tm_raster(col.legend = tm_legend(title = "Elevation (m)"))+
  tm_title(text = "original")+ 
  tm_layout(meta.margins = c(.2, 0, 0, 0))

map2 <- tm_shape(masked1) +
  tm_raster(col.legend = tm_legend(title = "Elevation (m)"))+
  tm_title(text = "bracket subsetting")+ 
  tm_layout(meta.margins = c(.2, 0, 0, 0))

map3 <- tm_shape(masked2) +
  tm_raster(col.legend = tm_legend(title = "Elevation (m)"))+
  tm_title(text = "mask()")+ 
  tm_layout(meta.margins = c(.2, 0, 0, 0))

tmap_arrange(map1, map2, map3, nrow = 1) 
```

### Compute the change in light intensity

```{r}
r_change <- r_after - r_before
```

### Reclassify to create the blackout mask 

classify() or conditional logic (`ifel()` or `r_change[r_change > -200] <- NA`)

The idea:

- If the drop in brightness < 200 nW cm⁻² sr⁻¹ → assign NA

- Otherwise → assign 1 (or TRUE) to indicate blackout

### Convert to vector (polygonize)

as.polygons() (from terra) or st_as_sf() (from sf)

Then st_make_valid() to fix any invalid geometries.

### Crop to Houston region

You’ll use:

vect() to make a bounding box with those coordinates:
ext(-96.5, -94.5, 29, 30.5)
crop() to spatially subset the blackout polygons.

Only keep blackout polygons that fall inside the Houston area.

### Reproject to EPSG:3083

project() (if raster) or st_transform() (if sf object).
Goal: Convert to the Texas Centric Albers Equal Area projection.

# Discussion

# Conclusion

