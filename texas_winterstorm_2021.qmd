---
title: ": A Look at Houston's Winter Storm Blackouts"
author: "Melannie Moreno Rolón"
date: "2025-11-11"
format:
  pdf: 
    code-fold: false
    number-sections: true
    mainfont: "Arial"
    fontsize: 12pt
    geometry: margin=1in
editor: source
execute: 
  warning: false
  message: false
  results: false
editor_options: 
  chunk_output_type: console
---

```{r}
#| label: setup
# Import libraries
library(tidyverse)
library(tmap)
library(terra)
library(sf)
library(ggspatial)
library(here)
```


# README.md



# Introduction

Rapid changes in climate are leading to higher intensity and more frequent extreme weather events in recent years. If we look at the United States, there are many examples. One particular event that highlights this increasing pattern in weather events are the February 2021 winter storms in Houston, Texas. For the first time in years, Houston experienced a power outage of massive scale. A combination of extreme weather, grid isolation, and lack of winterization became the perfect storm that exposed Houston's underlying systemic issues. 

This analysis aims to estimate the number of households in the Houston metropolitan area that resulted in loss of electricity service due to the extreme winter storms experienced in February 2021. 

# Methods

Key steps of this analysis include:

1. Find locations that experienced a blackout
2. Exclude highways from analysis
3. Identify homes that experienced blackouts by combining the locations of homes and blackouts
4. Identify the census tracts likely impacted by blackout

# Data Analysis

### Import Socioeconomic Data
```{r}
#|label: census-data
# Explore layers of geo-database
st_layers(here::here("data", "ACS_2019_5YR_TRACT_48_TEXAS.gdb"))

# Load 2019 socioeconomic census tract data
census_tracts <- st_read(here::here("data", "ACS_2019_5YR_TRACT_48_TEXAS.gdb"),
                        layer = "ACS_2019_5YR_TRACT_48_TEXAS", quiet = T)

# Load household income data
income <- st_read(here::here("data", "ACS_2019_5YR_TRACT_48_TEXAS.gdb"), 
                  layer = "X19_INCOME", quiet = T)
```

### Import Roads and Homes Data
```{r}
#|label: rds-bldgs-data
# Load roads data
roads <- st_read(here::here("data", "gis_osm_roads_free_1.gpkg"),
                 query = "SELECT * FROM gis_osm_roads_free_1 WHERE fclass='motorway'")

# Load houses data
buildings <- st_read(here::here("data","gis_osm_buildings_a_free_1.gpkg"),
  query = "SELECT * FROM gis_osm_buildings_a_free_1 WHERE (type IS NULL AND name IS NULL) OR type IN ('residential', 'apartments', 'house', 'static_caravan', 'detached')")
```

### Import Satellite Images

```{r}
#|label: raster-data
# February 7 tiles
tile_0701 <- rast(here::here("data", "VNP46A1",
                             "VNP46A1.A2021038.h08v05.001.2021039064328.tif"))

tile_0702 <- rast(here::here("data","VNP46A1",
                  "VNP46A1.A2021038.h08v06.001.2021039064329.tif"))

# February 16 tiles
tile_1601 <- rast(here::here("data", "VNP46A1", "VNP46A1.A2021047.h08v05.001.2021048091106.tif"))


tile_1602 <- rast(here::here("data", "VNP46A1",
                             "VNP46A1.A2021047.h08v06.001.2021048091105.tif"))
```


### Blackout Detection
Find locations that experienced a blackout.
```{r}
#|label: merge-rasters
# Merge raster objects 
r_before <- terra::mosaic(tile_0701, tile_0702, fun = "mean")
r_after <- terra::mosaic(tile_1601, tile_1602, fun = "mean")
```

```{r}
#|label: light-diff
# Compute the change in light intensity
r_change <- r_before - r_after
```

```{r}
#| label: blackout-detection
# Create a re-classification matrix 
reclass_matrix <- matrix(c(-Inf, 200, NA,   # values below 200 → NA
                            200, Inf, 1),    # values above 200 → 1
                            ncol = 3,
                            byrow = TRUE)

# Reclassify the raster
masked_difference <- classify(r_change, reclass_matrix)

# Convert raster mask to polygons (vectorized blackout)
blackout_vector <- st_as_sf(as.polygons(masked_difference))
blackout_vector <- st_make_valid(blackout_vector)

```

```{r}
#|label: polygon-check
# Check that `blackout_vector` is a polygon
sum(!st_is_valid(blackout_vector))
```

```{r}
#| label: houston-crop
# Define the bounding box coordinates for Houston, Texas 
houston_bbox <- st_as_sfc(st_bbox(c(xmin = -96.5, xmax = -94.5, 
                                    ymin = 29, ymax = 30.5),
                                  crs = st_crs(blackout_vector))
                          )

# Crop the vectorized blackout polygons with the Houston bounding box
cropped_blackout <- st_crop(blackout_vector, houston_bbox) %>% st_make_valid()

# Reproject the cropped blackout vector to EPSG:3083 (Texas Centric Albers Equal Area)
cropped_blackout <- st_transform(cropped_blackout, 3083)
```


### Spatial Filtering
Exclude highways from the cropped blackout mask.

```{r}
#| label: check-crs-match
# Check CRS match between highways and blackout polygons
if (st_crs(roads) != st_crs(cropped_blackout)) {
  message("Transforming highways to match cropped_blackout CRS...")
  roads <- st_transform(roads, st_crs(cropped_blackout))
}

if (st_crs(roads) == st_crs(cropped_blackout)) {
  message("CRS matches.")
} else {
  message("CRS still doesn't match.")
}

```

```{r}
#| label: filter-highways
# Create a buffer of 200 meters
buffered_highways <- st_buffer(roads, dist = 200)

# Combine geometries
highways_200m <- st_union(buffered_highways)

# Erase overlapping areas to remove highways
blackout_not_highway <- st_difference(cropped_blackout, highways_200m)

# Fix invalid  geometries if necessary
if (sum(!st_is_valid(blackout_not_highway)) > 0) {
  blackout_not_highway <- st_make_valid(blackout_not_highway)
}
```

### Socioeconomic Context
Identify the number of homes likely impacted by blackouts.
```{r} 
#| label: check-crs-buildings
if (st_crs(buildings) != st_crs(blackout_not_highway)) {
  message("Transforming buildings to match blackout CRS...")
  buildings <- st_transform(buildings, st_crs(blackout_not_highway))
}

if (st_crs(buildings) == st_crs(blackout_not_highway)) {
  message("CRS matches!")
} else {
  message("CRS still doesn't match." )
  }
```

```{r}
#| label: homes-impacted
# Find the intersection of homes within Houston that experienced a blackout
buildings_affected <- st_intersection(buildings, blackout_not_highway)

# Find the number of homes affected by the blackout
num_affected <- nrow(buildings_affected)
message(paste("Number of homes likely impacted:", num_affected))


if (sum(!st_is_valid(buildings_affected)) > 0) {
  buildings_affected <- st_make_valid(buildings_affected)
}
```

### Compare the distributions of household income that experienced and did not experience a blackout 
```{r}
#| label: income-distr

# Clean the income dataset
income_clean <- income %>%
  # Remove geometries (there is not but just in case)
  st_drop_geometry() %>%
  # Remove last 10 characters so that they match with census tract's GEOID value format
  mutate(GEOID = substr(GEOID, nchar(GEOID) - 10, nchar(GEOID))) %>%
  select(GEOID, MEDIAN_HH_INC = B19013e1)

# Join income and census tract data
census_income <- left_join(census_tracts, income_clean, by = "GEOID")

# Check CRS match 
if (st_crs(blackout_not_highway) != st_crs(census_income)) {
    warning("CRS does not match")
    message("Transforming CRS to match...")
    census_income <- st_transform(census_income, st_crs(blackout_not_highway))
  }


# Identify which census tracts intersect blackout areas
census_blackout <- census_income[st_intersects(census_income, blackout_not_highway, sparse = FALSE), ]

# Add blackout status column
census_income <- census_income %>%
  # Add a new column 'blackout' 
  # Indicates whether each census tract's GEOID appears in the list of tracts that intersect blackout areas 
  # (Yes = experienced blackout, No = did not)
  mutate(blackout = ifelse(GEOID %in% census_blackout$GEOID, "Yes", "No"))

```


## Results

### Nightlights before and after the winterstorms
```{r}
#|label: vis1-nightlights
# Create a palette simulating light during a blackout
lights_pallete <- colorRampPalette(c("black", "gray20", "gray60", "yellow", "white"))(5)

# Night lights before storm
map_before <- tm_shape(r_before) +
  tm_raster(col.scale = tm_scale_intervals(style  = "quantile",
                                           n = 7,
                                           values = lights_pallete),
    col.legend = tm_legend(title = "Radiance (nW·cm⁻²·sr⁻¹)")) +
  tm_title(text = "Night lights before storm") +
  tm_layout(legend.outside = TRUE, component.autoscale = FALSE) + 
  tm_grid(lwd = .3)

# Night lights after storm
map_after <- tm_shape(r_after) + 
  tm_raster(col.scale = tm_scale_intervals(style  = "quantile",
                                           n = 7,
                                           values = lights_pallete),
            col.legend = tm_legend(title = "Radiance (nW·cm⁻²·sr⁻¹)")) +
  tm_title(text = "Night lights after storm") +
  tm_layout(legend.outside = TRUE, component.autoscale = FALSE) +
  tm_grid(lwd = .3)

# Combine
tmap_arrange(map_before, map_after)

```

**Figure 1.** Comparison of nightlight intensity across Houston before (February 7, 2021) and after (February 16, 2021) the winter storm.  
Lighter areas indicate higher radiance values, while darker areas represent reduced light intensity, likely due to power outages during the blackout.

### Homes in Houston that lost power
```{r}
#| label: vis2-blackout-homes
# Convert polygons to points for clearer display
buildings_points <- st_centroid(buildings_affected) %>% 
  select(geometry = geom)

# Plot the homes that experienced a blackout
tm_shape(blackout_not_highway) +
  tm_polygons(
    fill = "grey80",       # blackout mask color
    col = NA,              # no borders
    fill.legend = tm_legend(title = "Blackout areas (non-highway)")
  ) +
tm_shape(buildings_points) +
  tm_dots(
    col = NA,              # no borders
    fill = "red",          # buildings affected point color
    size = 0.1,
    fill_alpha = 0.3,
    fill.legend = tm_legend(title = "Homes affected")
  ) +
tm_add_legend(             # Add a point symbol in the legend
  type = "symbols",
  fill = "red",
  labels = "Homes affected",
  title = "Legend"
) +
tm_add_legend(             # Add a polygon symbol in the legend
  type = "polygons",
  fill = "grey80",
  labels = "Blackout areas",
  title = "Legend"
) +
tm_layout(
  frame = FALSE,
  legend.outside = TRUE
) +
  tm_title(text = "Homes in Houston that Lost Power") +
  tm_grid(lwd = 0.3)

```

**Figure 2.** Residential structures within Houston that likely lost power during the February 2021 blackout.  
Grey areas represent detected blackout zones (excluding highways) and red points indicate the locations of affected residential buildings.

## Census tracts that lost power after the storms

```{r}
#| label: vis3-census-blackouts
# Check that CRS matches
if (st_crs(blackout_not_highway) != st_crs(census_tracts)) {
  message("Transforming blsckout to match census_income CRS...")
  blackout_not_highway <- st_transform(blackout_not_highway, st_crs(census_tracts))
}


if (st_crs(blackout_not_highway) == st_crs(census_income)) {
  message("CRS matches!")
} else {
  message("CRS still doesn't match." )
  }

# Define the Houston bounding box (same extent you used before)
houston_bbox <- st_as_sfc(st_bbox(
  c(xmin = -96.5, xmax = -94.5, ymin = 29, ymax = 30.5),
  crs = 4326)) %>%  
  st_transform(st_crs(census_tracts))

# Crop the census tracts to the Houston area
census_houston <- st_crop(census_tracts, houston_bbox)

# Identify census tracts in Houston that intersect blackout areas
houston_blackout <- census_houston[st_intersects(census_houston, blackout_not_highway, sparse = FALSE), ]

# Add a column indicating whether a census tract experienced a blackout
census_houston$blackout <- "No"

# For every census tract in Houston, check if its 'osm_id' appears in 'houston_blackout'
census_houston$blackout <- ifelse(
  census_houston$osm_id %in% houston_blackout$osm_id,
  "Yes", "No")

# Plot the map
ggplot() +
  ggspatial::annotation_map_tile(zoom = 8, type = "osm") +
  annotation_scale(location = "bl") +            # Add scale bar (bottom left)
  annotation_north_arrow(location = "tl") +      # Add north arrow (top left)
  # Display tracts that experienced a blackout
  geom_sf(data = subset(census_houston, blackout == "Yes"),
          fill = "firebrick4", color = NA, alpha = 0.8) +   
  labs(
    title = "Census Tracts in Houston that Lost Power",
    fill = "Blackout experienced"
  ) +
  theme_minimal(base_size = 14) +
  theme(
    legend.position = "right",
    plot.title = element_text(hjust = 0.5, face = "bold"),
    axis.title = element_blank()
  )

```
**Figure 3.** Census tracts within the Houston metropolitan area that experienced blackouts following the winter storm.  
Red tracts denote areas that overlapped with the detected blackout mask, while lighter tracts did not show evidence of power loss.


## Compare the distributions of median household income for census tracts that did and did not experience blackouts

```{r}
#|label: vis4-hh-income
# Plot boxplot of median household income distribution by blackout experience
ggplot(data = census_income %>% filter(!is.na(MEDIAN_HH_INC)),
       aes(x = blackout, y = MEDIAN_HH_INC, fill = blackout)) +
  geom_boxplot(alpha = 0.8, outlier.color = "black") +
  scale_fill_manual(values = c("grey80", "firebrick4")) +
  # Add labels to x- and y-axis
  labs(title = "Median Household Income by Blackout Experience",
       x = "Blackout Experienced",
       y = "Median Household Income (USD)") +
  theme_classic(base_size = 14) +
  theme(legend.position = "none",
        plot.title = element_text(hjust = 0.5, face = "bold"))

```

**Figure 4.** Distribution of median household income for census tracts that did and did not experience blackouts.  
While blackout-affected tracts occurred across all income levels, slightly higher variability is observed in higher-income tracts. Further analysis is recommended to determine if this difference is significant.

# Discussion

This analysis estimated the spatial extent of Houston’s February 2021 winter storm blackouts by combining satellite night-light data, road networks, and census information. The results suggest that thousands of residential structures across diverse neighborhoods lost power, with outages distributed across both lower- and middle-income census tracts. While the data reveal clear spatial clustering of blackouts, several limitations remain. The night-light data provide an indirect proxy for outages and may underestimate impacts in densely developed or industrial areas. Additionally, variations in data resolution, cloud cover, and temporal mismatches between datasets introduce uncertainty in the estimated extent of power loss.

